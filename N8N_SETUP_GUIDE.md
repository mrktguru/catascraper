# üîß N8N Setup Guide - Catawiki Category Scraper

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

‚úÖ **404 Error** - API endpoint `/scrape-category` —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ **422 Error** - API –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç n8n
‚úÖ **403 Forbidden** - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ö–æ–¥ –∑–∞—â–∏—Ç—ã Catawiki/Akamai
‚úÖ **–°–µ–ª–µ–∫—Ç–æ—Ä—ã** - –ù–∞—Ö–æ–¥–∏—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚úÖ **–ü–∞—Ä—Å–∏–Ω–≥** - –£—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –ª–æ—Ç–∞

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Google Sheets

–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –¥–≤—É–º—è –ª–∏—Å—Ç–∞–º–∏:

**–õ–∏—Å—Ç "URL-CAT"** (–≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ):
```
| category url                                          | max pages |
|------------------------------------------------------|-----------|
| https://www.catawiki.com/en/s?q=burgundy&filters=... | 2         |
```

**–õ–∏—Å—Ç "CATALOG"** (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã):
```
| title | bottles_count | seller_name | current_price | shipping_cost | end_date | ... |
|-------|--------------|-------------|---------------|---------------|----------|-----|
| (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è)                                                      |
```

### 2. –ò–º–ø–æ—Ä—Ç Workflow –≤ n8n

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n
2. –ù–∞–∂–º–∏—Ç–µ **"+ Add workflow"**
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ–Ω—é (3 —Ç–æ—á–∫–∏) ‚Üí **"Import from File"**
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª: `n8n_workflow_category_FIXED.json`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Workflow

**–ò–∑–º–µ–Ω–∏—Ç–µ –≤ –Ω–æ–¥–∞—Ö:**

#### –ù–æ–¥–∞ "Read Category URLs" (ID: 2)
```json
"documentId": "YOUR_SPREADSHEET_ID"  // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ ID –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã
```

#### –ù–æ–¥–∞ "Write to CATALOG" (ID: 10)
```json
"documentId": "YOUR_SPREADSHEET_ID"  // ‚Üê –¢–æ—Ç –∂–µ ID
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Spreadsheet ID:**
```
https://docs.google.com/spreadsheets/d/1ABC...XYZ/edit
                                      ^^^^^^^^^^
                                      –≠—Ç–æ –∏ –µ—Å—Ç—å ID
```

### 4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Google Sheets

1. –í –Ω–æ–¥–µ "Read Category URLs" –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ "Google Sheets Account"
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π
3. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Google OAuth
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –Ω–æ–¥—ã "Write to CATALOG"

### 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Schedule (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ù–æ–¥–∞ "Schedule Trigger" –∑–∞–ø—É—Å–∫–∞–µ—Ç workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–¢–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
```
"cronExpression": "0 10 * * *"
```

**–î—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
```
"0 */6 * * *"   // –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
"0 0 * * 1"     // –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ –ø–æ–ª–Ω–æ—á—å
"0 22 * * *"    // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

1. –í n8n –æ—Ç–∫—Ä–æ–π—Ç–µ workflow
2. –ù–∞–∂–º–∏—Ç–µ **"Test workflow"**
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–æ–¥—É "Schedule Trigger"
4. –ù–∞–∂–º–∏—Ç–µ **"Execute Node"**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:8000/health

# 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
curl -X POST http://localhost:8000/scrape-category \
  -H "Content-Type: application/json" \
  -d '{
    "category_url": "https://www.catawiki.com/en/s?q=burgundy",
    "max_pages": 1,
    "headless": true,
    "save_csv": true
  }'

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ JOB_ID)
curl http://localhost:8000/job/JOB_ID

# 4. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
tail -f /tmp/catawiki-api.log
```

---

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Workflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Schedule Trigger‚îÇ  –ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Read URLs Sheet ‚îÇ  –ß–∏—Ç–∞–µ—Ç URL –∏–∑ "URL-CAT"
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Prepare URL     ‚îÇ  –ò–∑–≤–ª–µ–∫–∞–µ—Ç category_url –∏ max_pages
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Start Scraping  ‚îÇ  POST /scrape-category ‚Üí –ø–æ–ª—É—á–∞–µ—Ç job_id
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Wait 1 Minute   ‚îÇ  –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Å–∫—Ä–∞–ø–∏–Ω–≥
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Check Status    ‚îÇ  GET /job/{job_id}
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Route by Status ‚îÇ  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç status
‚îî‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ     ‚îÇ    ‚îÇ
  ‚îÇ     ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ     ‚îÇ                  ‚Üì
  ‚îÇ     ‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ     ‚îÇ          ‚îÇ Retry Counter ‚îÇ  –ï—Å–ª–∏ "running"
  ‚îÇ     ‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ     ‚îÇ                  ‚Üì
  ‚îÇ     ‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ     ‚îÇ          ‚îÇ Wait 90s      ‚îÇ
  ‚îÇ     ‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ     ‚îÇ                  ‚îÇ
  ‚îÇ     ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê (loop back)
  ‚îÇ     ‚îÇ                            ‚Üì
  ‚îÇ     ‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Log Error    ‚îÇ  –ï—Å–ª–∏ "failed"
  ‚îÇ                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Format Results  ‚îÇ  –ï—Å–ª–∏ "completed"
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Write to Sheet  ‚îÇ  –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ "CATALOG"
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Scraping

### max_pages

–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

- `null` –∏–ª–∏ –ø—É—Å—Ç–æ ‚Üí –ü–∞—Ä—Å–∏—Ç—å **–≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**
- `1` ‚Üí –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (~24 –ª–æ—Ç–∞)
- `5` ‚Üí –ü–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–∞–Ω–∏—Ü (~120 –ª–æ—Ç–æ–≤)

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ = ~2 –º–∏–Ω—É—Ç—ã
- 5 —Å—Ç—Ä–∞–Ω–∏—Ü = ~10 –º–∏–Ω—É—Ç
- –í—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (60+ —Å—Ç—Ä–∞–Ω–∏—Ü) = 2+ —á–∞—Å–∞

### headless

- `true` ‚Üí –ë—Ä–∞—É–∑–µ—Ä –±–µ–∑ GUI (–±—ã—Å—Ç—Ä–µ–µ, –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏)
- `false` ‚Üí –í–∏–¥–∏–º—ã–π –±—Ä–∞—É–∑–µ—Ä (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

### save_csv

- `true` ‚Üí –°–æ—Ö—Ä–∞–Ω—è—Ç—å CSV —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `false` ‚Üí –¢–æ–ª—å–∫–æ JSON –≤ –ø–∞–º—è—Ç–∏

---

## üîß Troubleshooting

### Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–æ–¥–∞ "Read Category URLs" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Spreadsheet ID
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ª–∏—Å—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "URL-CAT" (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∞ "category url"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google Sheets –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404

**–ü—Ä–æ–±–ª–µ–º–∞:** `/scrape-category` –Ω–µ –Ω–∞–π–¥–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ
cd /root/cataparser
git branch  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: claude/fix-404-category-error-...
git pull origin claude/fix-404-category-error-01EnBeZezDLB5Bn3HepuyJ7A

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API
kill -9 $(lsof -t -i:8000)
nohup python3 api_server.py > /tmp/catawiki-api.log 2>&1 &
```

### –í—Å–µ–≥–¥–∞ status "failed"

**–ü—Ä–æ–±–ª–µ–º–∞:** Job –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ API
tail -n 100 /tmp/catawiki-api.log

# –ò—â–∏—Ç–µ:
# - "‚ùå Catawiki –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–æ—Å—Ç—É–ø (403)" ‚Üí –ü—Ä–æ–±–ª–µ–º–∞ —Å IP
# - "–°–µ–ª–µ–∫—Ç–æ—Ä '...': –Ω–∞–π–¥–µ–Ω–æ 0 —ç–ª–µ–º–µ–Ω—Ç–æ–≤" ‚Üí –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏
# - "HTML —Ä–∞–∑–º–µ—Ä: 297 —Å–∏–º–≤–æ–ª–æ–≤" ‚Üí Catawiki –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ 403 –∏–ª–∏ 297 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí API –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É.

### –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç –ª–æ—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** "–ù–∞–π–¥–µ–Ω–æ 0 –∫–∞—Ä—Ç–æ—á–µ–∫ –ª–æ—Ç–æ–≤"

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `/en/s?q=`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é

### –î–æ–ª–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –°–∫—Ä–∞–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
- 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (~24 –ª–æ—Ç–∞) = 2-3 –º–∏–Ω—É—Ç—ã
- 5 —Å—Ç—Ä–∞–Ω–∏—Ü (~120 –ª–æ—Ç–æ–≤) = 10-15 –º–∏–Ω—É—Ç
- –ü–æ–ª–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (60+ —Å—Ç—Ä–∞–Ω–∏—Ü) = 2-4 —á–∞—Å–∞

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ `max_pages` –¥–æ 1-2 —Å—Ç—Ä–∞–Ω–∏—Ü
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `headless: true`

### Timeout –≤ n8n

**–ü—Ä–æ–±–ª–µ–º–∞:** n8n –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. Workflow –∏—Å–ø–æ–ª—å–∑—É–µ—Ç retry –º–µ—Ö–∞–Ω–∏–∑–º (–¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫)
2. –ï—Å–ª–∏ job "running" ‚Üí workflow –∂–¥–µ—Ç 90 —Å–µ–∫—É–Ω–¥ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–Ω–æ–≤–∞
3. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è = 5 retries √ó 90s = ~10 –º–∏–Ω—É—Ç

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí —É–≤–µ–ª–∏—á—å—Ç–µ retry count –≤ –Ω–æ–¥–µ "Retry Counter".

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ CATALOG

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|----------|--------|
| title | –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–Ω–∞ | "2023 Hubert Lamy En Remilly..." |
| bottles_count | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É—Ç—ã–ª–æ–∫ | "1" |
| seller_name | –ò–º—è –ø—Ä–æ–¥–∞–≤—Ü–∞ | "Wine Experts Ltd" |
| current_price | –¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞ | "‚Ç¨ 25" |
| shipping_cost | –î–æ—Å—Ç–∞–≤–∫–∞ | "‚Ç¨ 20" |
| end_date | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (—Ñ–æ—Ä–º—É–ª–∞) | =DAYS(...) |
| images_count | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ | 15 |
| first_image | –ö–∞—Ä—Ç–∏–Ω–∫–∞ (—Ñ–æ—Ä–º—É–ª–∞) | =IMAGE("https://...") |
| url | –°—Å—ã–ª–∫–∞ (—Ñ–æ—Ä–º—É–ª–∞) | =HYPERLINK("...") |
| scraped_at | –î–∞—Ç–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ | "2025-11-25T20:10:00" |
| producer_rating | –†–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è | "8/10" |
| vintage_rating | –†–µ–π—Ç–∏–Ω–≥ –≤–∏–Ω—Ç–∞–∂–∞ | "9/10" |

### Google Sheets –§–æ—Ä–º—É–ª—ã

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ñ–æ—Ä–º—É–ª—ã:

**–ö–∞—Ä—Ç–∏–Ω–∫–∞:**
```
=IMAGE("https://assets.catawiki.com/...", 4, 100, 100)
```

**–°—Å—ã–ª–∫–∞:**
```
=HYPERLINK("https://www.catawiki.com/en/l/...", "üîó View")
```

**–û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç:**
```
=DAYS(DATEVALUE("2025-11-30") + TIMEVALUE("19:37:00"), NOW()) & "d " & ...
```

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –†–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

‚ö†Ô∏è Catawiki –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à IP –ø—Ä–∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ 1-2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å
- ‚úÖ max_pages: 1-5 —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 3+ —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ª–æ—Ç–∞–º–∏ (—É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω–æ)
- ‚ùå –ù–ï –ø–∞—Ä—Å–∏—Ç—å –≤—Å—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–∞–∂–¥—ã–π —á–∞—Å

### Legal

–≠—Ç–æ—Ç —Å–∫—Ä–∞–ø–µ—Ä –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è:
- ‚úÖ –õ–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞
- ‚ùå –ù–ï –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è Catawiki

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:**
- RAM: 2GB –º–∏–Ω–∏–º—É–º (4GB —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- CPU: 2 —è–¥—Ä–∞
- –ú–µ—Å—Ç–æ: 1GB –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ Chromium
- –°–µ—Ç—å: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–æ–≥–∏ API

```bash
# –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
tail -f /tmp/catawiki-api.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
tail -n 100 /tmp/catawiki-api.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep "‚ùå\|ERROR\|Failed" /tmp/catawiki-api.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
# Health check
curl http://localhost:8000/health

# –°–ø–∏—Å–æ–∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
curl http://localhost:8000/

# –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
curl http://localhost:8000/jobs
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API
cd /root/cataparser
./restart_api.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
kill -9 $(lsof -t -i:8000)
nohup python3 api_server.py > /tmp/catawiki-api.log 2>&1 &

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep api_server.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
lsof -i :8000
```

---

## ‚úÖ Checklist –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- [ ] API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ
- [ ] –ë—Ä–∞—É–∑–µ—Ä—ã Playwright —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`python3 -m playwright install chromium`)
- [ ] API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å `/scrape-category` —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ç—É—Å 200, HTML > 100KB)
- [ ] Google Sheets —Å–æ–∑–¥–∞–Ω–∞ —Å –ª–∏—Å—Ç–∞–º–∏ "URL-CAT" –∏ "CATALOG"
- [ ] Workflow –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ n8n
- [ ] Spreadsheet ID –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –æ–±–µ–∏—Ö –Ω–æ–¥–∞—Ö
- [ ] Google Sheets –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ workflow —É—Å–ø–µ—à–µ–Ω
- [ ] –î–∞–Ω–Ω—ã–µ –ø–æ—è–≤–∏–ª–∏—Å—å –≤ –ª–∏—Å—Ç–µ "CATALOG"

**–ï—Å–ª–∏ –≤—Å–µ –≥–∞–ª–æ—á–∫–∏ ‚úÖ ‚Üí Workflow –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!** üéâ

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ** –≤ –Ω–æ–¥–µ "Schedule Trigger"
2. **–î–æ–±–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –≤ –Ω–æ–¥—É "Log Error" (email, Slack, etc.)
3. **–§–∏–ª—å—Ç—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –ø–æ —Ü–µ–Ω–µ, —Ä–µ–≥–∏–æ–Ω—É, –ø—Ä–æ–¥–∞–≤—Ü—É –≤ Google Sheets
4. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç—Ä–µ–Ω–¥—ã** - —Å–æ–∑–¥–∞–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ Google Sheets

–£–¥–∞—á–∏! üç∑
